---
title: 'Data Management & Analysis Final Project'
subtitle: 'Replication and Extention for Acemoglu, Naidu, Restrepo and Robinson (2019)'
author: 
  - "(Name:) Shoya Abe (University ID:) 31B24001"
  - "(Name:) Honoka Ohtani (University ID:) 31B24002"
date: "(Submission Due:) 2025/02/06"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
  html_document:
    df_print: paged
    toc: true
    toc_depth: 3
    number_sections: true
  word_document:
    toc: true
    toc_depth: 3
    number_sections: true
header-includes:
  - \usepackage{booktabs}
  - \usepackage{float}
  - \usepackage[table]{xcolor}
---

\newpage

## Setup
  
```{r setup, echo=TRUE, cache=FALSE, warning=FALSE, message=FALSE}
pacman::p_load(
  rmdformats,
  knitr,
  tinytex,
  haven,
  tidyverse,
  kableExtra,
  plm,
  texreg
)

## Global options
options(max.print="75")
opts_chunk$set(fig.align="center",
               echo=TRUE,
               cache=TRUE,
               prompt=FALSE,
               tidy=FALSE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

# About this Report

## Project Type

## Summary of the Paper

### What the problem is

### Why it is important

### How you solve the problem

### What we find

## Data

We utilize data obtained from the replication files available in the data archive on Professor Daron Acemoglu's homepage. This dataset consists of a large panel of 175 countries. The sample size is 9,384, and the number of variables is 1,177. A list of variables is provided in the appendix.

```{r}
data <- read_dta("data/raw/DDCGdata_final.dta")

summarize_data <- function(data, n = 10) {
  cat("Sample size (number of rows):",
      nrow(data), "\n")
  cat("Number of variables (columns):",
      ncol(data), "\n")
}

summarize_data(data)
```

## Empirical Methods

Here, we will briefly explain the empirical methods we use for replication. The original paper used a number of emiprical methods to strengthen the robustness of the results. Among them, we reproduce three methods\footnote{We also worked on Arellano-Bond estimation in table.2. However, it took an enormous amount of computation time and the results obtained were quite different from the original results. In other words, replication failed. However, in the belief that it is desirable to disclose the entire analysis process and results, we disclose the analysis code and results in the appendix.}.
s
### Event Study (Figure.1)

### Dynamic Liner Panel Model (Table.2)

Next, we estimate the following dynamic linear panel model.
\begin{align*}
&Y_{ct} = \beta D_{ct} + \gamma_1 y_{ct-1} + \alpha_c + \delta_t + \epsilon_{ct}, \tag{1} \\
&Y_{ct} = \beta D_{ct} + \sum_{j = 1}^2 \gamma_j y_{ct-j} + \alpha_c + \delta_t + \epsilon_{ct}, \tag{2} \\
&Y_{ct} = \beta D_{ct} + \sum_{j = 1}^4 \gamma_j y_{ct-j} + \alpha_c + \delta_t + \epsilon_{ct}, \tag{3} \\
&Y_{ct} = \beta D_{ct} + \sum_{j = 1}^8 \gamma_j y_{ct-j} + \alpha_c + \delta_t + \epsilon_{ct}, \tag{4}
\end{align*}
where $y_{ct}$ is the log of GDP per capita in country $c$ at time $t$ and $D_{ct}$ is a dummy variable that takes the value 1 if country $c$ is a democracy at time $t$ and 0 otherwise.

# Replication

## Figure.1

### Preprocessing

```{r}
data_f1 <- data %>%
  rename(id = "_ID") %>%
  group_by(id) %>%
  arrange(year) %>%
  mutate(
    prev_dem = dplyr::lag(dem, 1),
    transition = case_when(
      dem == 1 & prev_dem == 0 ~ 1,
      dem == 0 & prev_dem == 0 ~ 0,
      TRUE ~ NA_real_
    ),
    lag1 = dplyr::lag(y, 1),
    lag2 = dplyr::lag(y, 2),
    lag3 = dplyr::lag(y, 3),
    lag4 = dplyr::lag(y, 4)
  ) %>%
  filter(
    !is.na(lag1) &
      !is.na(lag2) &
      !is.na(lag3) &
      !is.na(lag4)
  ) %>%
  ungroup()

for (t in -15:-2) {
  col_name <- paste0("gdpDiff_m", abs(t))
  data_f1 <- data_f1 %>%
    group_by(id) %>%
    arrange(year) %>%
    mutate(!!col_name := dplyr::lag(y, abs(t)) - lag1) %>%
    ungroup()
}

data_f1 <- data_f1 %>%
  mutate(
    gdpDiff_m1 = 0,
    gdpDiff_0  = y - lag1
  )

for (t in 1:30) {
  col_name <- paste0("gdpDiff_p", t)
  data_f1 <- data_f1 %>%
    group_by(id) %>%
    arrange(year) %>%
    mutate(!!col_name := dplyr::lead(y, t) - lag1) %>%
    ungroup()
}

data_f1 <- data_f1 %>%
  filter(!is.na(transition))
```

### Estimation

```{r}
estimateATT <- function(outcome_col) {
  sub_data <- data_f1 %>%
    filter(
      !is.na(.data[[outcome_col]]),
      !is.na(transition)
    )
  if (nrow(sub_data) == 0)
    return(NA)

  year_levels <- sort(unique(sub_data$year))
  sub_data <- sub_data %>%
    mutate(year_factor = factor(year, levels = year_levels))

  control_data <- sub_data %>%
    filter(transition == 0)
  treated_data <- sub_data %>%
    filter(transition == 1)

  if (nrow(control_data) < 2 ||
      length(unique(control_data$year)) < 2)
    return(NA)

  model_formula <- as.formula(
    paste(outcome_col, "~ year_factor - 1")
  )

  control_model <- tryCatch(
    lm(model_formula, data = control_data),
    error = function(e) NULL
  )

  if (is.null(control_model))
    return(NA)

  predicted_outcomes <- tryCatch(
    predict(control_model, newdata = treated_data),
    error = function(e) rep(NA, nrow(treated_data))
  )

  treatment_effects <- treated_data[[outcome_col]] - predicted_outcomes
  mean(treatment_effects, na.rm = TRUE)
}

relative_times <- c(seq(-15, -1), seq(0, 30))
atets <- numeric(length(relative_times))

for (i in seq_along(relative_times)) {
  t_val <- relative_times[i]
  if (t_val < 0) {
    col_name <- paste0("gdpDiff_m", abs(t_val))
  } else {
    col_name <- if (t_val == 0)
      "gdpDiff_0" else paste0("gdpDiff_p", t_val)
  }
  atets[i] <- estimateATT(col_name)
}

results_df <- data.frame(
  RelativeTime = relative_times,
  ATT          = atets
)
```

### Plot

```{r}
figure_1 <- ggplot(results_df, aes(x = RelativeTime, y = ATT)) +
  geom_line(color = "black") +
  scale_x_continuous(breaks = seq(-15, 30, 5)) +
  labs(
    x = "Years around Democratization",
    y = "Change in GDP per capita (log points)"
  ) +
  theme_bw()

ggsave("output/figure_1.pdf",
       width = 14,
       height = 8,
       units = "cm")
```

![Event Study](output/figure_1.pdf)

## Table.1

### Preprocessing

```{r}
var_info <- tibble(
  var = c(
    "gdppercapitaconstant2000us",
    "ginv",
    "tradewb",
    "prienr",
    "secenr",
    "taxratio",
    "mortnew",
    "unrestn",
    "marketref"
  ),
  label = c(
    "GDP per capita",
    "Investment share of GDP",
    "Trade share of GDP",
    "Primary-school enrollment rate",
    "Secondary-school enrollment rate",
    "Tax revenue share of GDP",
    "Child mortality per 1,000 births",
    "Unrest rate",
    "Market reforms index (0â€“100)"
  )
)

calc_summary <- function(df, var, group_var) {
  df %>%
    filter(!is.na(.data[[var]])) %>%
    group_by({{ group_var }}) %>%
    summarise(
      Observations = n(),
      Mean         = mean(.data[[var]], na.rm = TRUE),
      SD           = sd(.data[[var]], na.rm = TRUE),
      .groups      = "drop"
    ) %>%
    mutate(Variable = var)
}

var_list <- var_info$var
```

### Caliculation

```{r}
summary_table <- lapply(
  var_list,
  function(x) calc_summary(data, x, dem)
) %>%
  bind_rows() %>%
  pivot_wider(
    names_from  = dem,
    values_from = c(Observations, Mean, SD),
    names_glue  = "{.value}_dem{dem}"
  ) %>%
  rename(
    Observations_Nondem = Observations_dem0,
    Mean_Nondem         = Mean_dem0,
    SD_Nondem           = SD_dem0,
    Observations_Dem    = Observations_dem1,
    Mean_Dem            = Mean_dem1,
    SD_Dem              = SD_dem1
  ) %>%
  left_join(
    var_info,
    by = c("Variable" = "var")
  ) %>%
  select(
    label,
    Observations_Nondem,
    Mean_Nondem,
    SD_Nondem,
    Observations_Dem,
    Mean_Dem,
    SD_Dem
  ) %>%
  rename(Variable = label)

colnames(summary_table) <- c(
  "Variable",
  "Observations",
  "Mean",
  "SD",
  "Observations",
  "Mean",
  "SD"
)
```

### Tabulation

```{r}
latex_table <- summary_table %>%
  kbl(
    caption   = "Summary Statistics by Democracy Status",
    format    = "latex",
    booktabs  = TRUE,
    digits    = 2
  ) %>%
  add_header_above(
    c(" " = 1, "Nondemocracies" = 3, "Democracies" = 3)
  ) %>%
  kable_styling(
    latex_options = c("HOLD_position", "striped")
  )

save_kable(latex_table, file = "output/table_1.tex")
```

\input{output/table_1.tex}

## Table.2

### Preprocessing

```{r}
data_t2 <- data %>%
  select(1:30) %>%
  group_by(country_name) %>%
  arrange(year) %>%
  mutate(
    lag1 = dplyr::lag(y, 1),
    lag2 = dplyr::lag(y, 2),
    lag3 = dplyr::lag(y, 3),
    lag4 = dplyr::lag(y, 4),
    lag5 = dplyr::lag(y, 5),
    lag6 = dplyr::lag(y, 6),
    lag7 = dplyr::lag(y, 7),
    lag8 = dplyr::lag(y, 8)
  ) %>%
  ungroup()
```

### Estimation

```{r}
data_m1 <- data_t2 %>%
  drop_na(y, dem, lag1)
data_m1 <- pdata.frame(data_m1,
                       index = c("country_name", "year"))
model_1 <- plm(
  y ~ dem + lag1,
  data   = data_m1,
  model  = "within",
  effect = "twoways"
)

data_m2 <- data_t2 %>%
  drop_na(y, dem, lag1, lag2)
data_m2 <- pdata.frame(data_m2,
                       index = c("country_name", "year"))
model_2 <- plm(
  y ~ dem + lag1 + lag2,
  data   = data_m2,
  model  = "within",
  effect = "twoways"
)

data_m3 <- data_t2 %>%
  drop_na(y, dem, lag1, lag2, lag3, lag4)
data_m3 <- pdata.frame(data_m3,
                       index = c("country_name", "year"))
model_3 <- plm(
  y ~ dem + lag1 + lag2 + lag3 + lag4,
  data   = data_m3,
  model  = "within",
  effect = "twoways"
)

data_m4 <- data_t2 %>%
  drop_na(y, dem, lag1, lag2, lag3, lag4,
          lag5, lag6, lag7, lag8)
data_m4 <- pdata.frame(data_m4,
                       index = c("country_name", "year"))
model_4 <- plm(
  y ~ dem + lag1 + lag2 + lag3 + lag4 +
    lag5 + lag6 + lag7 + lag8,
  data   = data_m4,
  model  = "within",
  effect = "twoways"
)

beta_hat_1  <- coef(model_1)["dem"]
gamma_hat_1 <- coef(model_1)[c("lag1")]
long_run_effect_1 <- beta_hat_1 / (1 - sum(gamma_hat_1))

beta_hat_2  <- coef(model_2)["dem"]
gamma_hat_2 <- coef(model_2)[c("lag1", "lag2")]
long_run_effect_2 <- beta_hat_2 / (1 - sum(gamma_hat_2))

beta_hat_3  <- coef(model_3)["dem"]
gamma_hat_3 <- coef(model_3)[c("lag1", "lag2", "lag3", "lag4")]
long_run_effect_3 <- beta_hat_3 / (1 - sum(gamma_hat_3))

beta_hat_4  <- coef(model_4)["dem"]
gamma_hat_4 <- coef(model_4)[c("lag1", "lag2", "lag3",
                               "lag4", "lag5", "lag6",
                               "lag7", "lag8")]
long_run_effect_4 <- beta_hat_4 / (1 - sum(gamma_hat_4))

lre <- round(
  c(
    long_run_effect_1,
    long_run_effect_2,
    long_run_effect_3,
    long_run_effect_4
  ),
  3
)
print(lre)

pers1 <- sum(coef(model_1)[2])
pers2 <- sum(coef(model_2)[2:3])
pers3 <- sum(coef(model_3)[2:5])
pers4 <- sum(coef(model_4)[2:9])
pers <- round(
  c(pers1, pers2, pers3, pers4),
  3
)
print(pers)

dem_shortrun <- coef(model_1)["dem"]
lag1_mod1 <- coef(model_1)[2]
effect1 <- dem_shortrun
effect2 <- (effect1 * lag1_mod1) + dem_shortrun
effects_mod1 <- c(effect1, effect2)

for (i in 3:30) {
  eff <- (effects_mod1[i-1] * lag1_mod1) + dem_shortrun
  effects_mod1 <- c(effects_mod1, eff)
}
eff_25_1 <- effects_mod1[25]

dem_shortrun <- coef(model_2)["dem"]
lag1_mod2 <- coef(model_2)[2]
lag2_mod2 <- coef(model_2)[3]
effect1 <- dem_shortrun
effect2 <- (effect1 * lag1_mod2) + dem_shortrun
effect3 <- (effect2 * lag1_mod2) +
  (effect1 * lag2_mod2) +
  dem_shortrun
effects_mod2 <- c(effect1, effect2, effect3)

for (i in 4:30) {
  eff <- (effects_mod2[i-1] * lag1_mod2) +
    (effects_mod2[i-2] * lag2_mod2) +
    dem_shortrun
  effects_mod2 <- c(effects_mod2, eff)
}
eff_25_2 <- effects_mod2[25]

dem_shortrun <- coef(model_3)["dem"]
lag1_mod3 <- coef(model_3)[2]
lag2_mod3 <- coef(model_3)[3]
lag3_mod3 <- coef(model_3)[4]
lag4_mod3 <- coef(model_3)[5]
effect1 <- dem_shortrun
effect2 <- (effect1 * lag1_mod3) + dem_shortrun
effect3 <- (effect2 * lag1_mod3) +
  (effect1 * lag2_mod3) +
  dem_shortrun
effect4 <- (effect3 * lag1_mod3) +
  (effect2 * lag2_mod3) +
  (effect1 * lag3_mod3) +
  dem_shortrun
effects_mod3 <- c(effect1, effect2, effect3, effect4)

for (i in 5:30) {
  eff <- (effects_mod3[i-1] * lag1_mod3) +
    (effects_mod3[i-2] * lag2_mod3) +
    (effects_mod3[i-3] * lag3_mod3) +
    (effects_mod3[i-4] * lag4_mod3) +
    dem_shortrun
  effects_mod3 <- c(effects_mod3, eff)
}
eff_25_3 <- effects_mod3[25]

dem_shortrun <- coef(model_4)["dem"]
lag1_mod4 <- coef(model_4)[2]
lag2_mod4 <- coef(model_4)[3]
lag3_mod4 <- coef(model_4)[4]
lag4_mod4 <- coef(model_4)[5]
lag5_mod4 <- coef(model_4)[6]
lag6_mod4 <- coef(model_4)[7]
lag7_mod4 <- coef(model_4)[8]
lag8_mod4 <- coef(model_4)[9]
effect1 <- dem_shortrun
effect2 <- (effect1 * lag1_mod4) + dem_shortrun
effect3 <- (effect2 * lag1_mod4) +
  (effect1 * lag2_mod4) +
  dem_shortrun
effect4 <- (effect3 * lag1_mod4) +
  (effect2 * lag2_mod4) +
  (effect1 * lag3_mod4) +
  dem_shortrun
effect5 <- (effect4 * lag1_mod4) +
  (effect3 * lag2_mod4) +
  (effect2 * lag3_mod4) +
  (effect1 * lag4_mod4) +
  dem_shortrun
effect6 <- (effect5 * lag1_mod4) +
  (effect4 * lag2_mod4) +
  (effect3 * lag3_mod4) +
  (effect2 * lag4_mod4) +
  (effect1 * lag5_mod4) +
  dem_shortrun
effect7 <- (effect6 * lag1_mod4) +
  (effect5 * lag2_mod4) +
  (effect4 * lag3_mod4) +
  (effect3 * lag4_mod4) +
  (effect2 * lag5_mod4) +
  (effect1 * lag6_mod4) +
  dem_shortrun
effect8 <- (effect7 * lag1_mod4) +
  (effect6 * lag2_mod4) +
  (effect5 * lag3_mod4) +
  (effect4 * lag4_mod4) +
  (effect3 * lag5_mod4) +
  (effect2 * lag6_mod4) +
  (effect1 * lag7_mod4) +
  dem_shortrun
effects_mod4 <- c(effect1, effect2, effect3, effect4,
                  effect5, effect6, effect7, effect8)

for (i in 9:30) {
  eff <- (effects_mod4[i-1] * lag1_mod4) +
    (effects_mod4[i-2] * lag2_mod4) +
    (effects_mod4[i-3] * lag3_mod4) +
    (effects_mod4[i-4] * lag4_mod4) +
    (effects_mod4[i-5] * lag5_mod4) +
    (effects_mod4[i-6] * lag6_mod4) +
    (effects_mod4[i-7] * lag7_mod4) +
    (effects_mod4[i-8] * lag8_mod4) +
    dem_shortrun
  effects_mod4 <- c(effects_mod4, eff)
}
eff_25_4 <- effects_mod4[25]

eff_25 <- round(
  c(eff_25_1, eff_25_2, eff_25_3, eff_25_4),
  3
)
print(eff_25)

se1 <- sqrt(diag(vcov(model_1)))
se2 <- sqrt(diag(vcov(model_2)))
se3 <- sqrt(diag(vcov(model_3)))
se4 <- sqrt(diag(vcov(model_4)))

override.coef.1 <- c(
  coef(model_1)["dem"],
  coef(model_1)["lag1"],
  NA, NA, NA, NA, NA, NA, NA
)
override.se.1 <- c(
  se1["dem"],
  se1["lag1"],
  NA, NA, NA, NA, NA, NA, NA
)

override.coef.2 <- c(
  coef(model_2)["dem"],
  coef(model_2)["lag1"],
  coef(model_2)["lag2"],
  NA, NA, NA, NA, NA, NA
)
override.se.2 <- c(
  se2["dem"],
  se2["lag1"],
  se2["lag2"],
  NA, NA, NA, NA, NA, NA
)

override.coef.3 <- c(
  coef(model_3)["dem"],
  coef(model_3)["lag1"],
  coef(model_3)["lag2"],
  coef(model_3)["lag3"],
  coef(model_3)["lag4"],
  NA, NA, NA, NA
)
override.se.3 <- c(
  se3["dem"],
  se3["lag1"],
  se3["lag2"],
  se3["lag3"],
  se3["lag4"],
  NA, NA, NA, NA
)

override.coef.4 <- c(
  coef(model_4)["dem"],
  coef(model_4)["lag1"],
  coef(model_4)["lag2"],
  coef(model_4)["lag3"],
  coef(model_4)["lag4"],
  coef(model_4)["lag5"],
  coef(model_4)["lag6"],
  coef(model_4)["lag7"],
  coef(model_4)["lag8"]
)
override.se.4 <- c(
  se4["dem"],
  se4["lag1"],
  se4["lag2"],
  se4["lag3"],
  se4["lag4"],
  se4["lag5"],
  se4["lag6"],
  se4["lag7"],
  se4["lag8"]
)
```

### Tabulation

```{r}
models <- list(model_1, model_2, model_3, model_4)

texreg(
  models,
  override.coef = list(
    override.coef.1,
    override.coef.2,
    override.coef.3,
    override.coef.4
  ),
  override.se = list(
    override.se.1,
    override.se.2,
    override.se.3,
    override.se.4
  ),
  custom.model.names = c(
    "(1)", "(2)", "(3)", "(4)"
  ),
  custom.coef.names = c(
    "Democracy", "Lag 1", "Lag 2",
    "Lag 3", "Lag 4", "Lag 5",
    "Lag 6", "Lag 7", "Lag 8"
  ),
  custom.gof.rows = list(
    "Persistence"          = pers,
    "Long run effect"      = lre,
    "Effect after 25 years" = eff_25
  ),
  file = "output/table_2_FE.tex",
  caption = "Effect of Democracy on (Log) GDP per Capita"
)
```

\input{output/table_2_FE.tex}

## Figure.2

## Table.3

## Table.4

## Table.5

# Extention

\newpage

# Appendix

## List of Variables

```{r}
var_labels <- sapply(data, function(x) attr(x, "label"))

list_var <- tibble::tibble(
  variable = names(var_labels),
  label    = var_labels
)

kable(
  list_var,                
  format    = "latex",      
  booktabs  = TRUE,         
  longtable = TRUE,         
  caption   = "List of Variables"
) %>%
  kable_styling(
    latex_options = c("repeat_header")
  )
```

## GMM Estimation for Table.2

```{r, echo=TRUE, eval=FALSE}
data_t2 <- data %>%
  select(1:30) %>%
  group_by(country_name) %>%
  arrange(year) %>%
  mutate(
    lag1 = dplyr::lag(y, 1),
    lag2 = dplyr::lag(y, 2),
    lag3 = dplyr::lag(y, 3),
    lag4 = dplyr::lag(y, 4),
    lag5 = dplyr::lag(y, 5),
    lag6 = dplyr::lag(y, 6),
    lag7 = dplyr::lag(y, 7),
    lag8 = dplyr::lag(y, 8)
  ) %>%
  ungroup()

data_m1 <- data_t2 %>% drop_na(y, dem, lag1)
data_m1 <- pdata.frame(data_m1, index = c("country_name", "year"))
data_m2 <- data_t2 %>% drop_na(y, dem, lag1, lag2)
data_m2 <- pdata.frame(data_m2, index = c("country_name", "year"))
data_m3 <- data_t2 %>% drop_na(y, dem, lag1, lag2, lag3, lag4)
data_m3 <- pdata.frame(data_m3, index = c("country_name", "year"))
data_m4 <- data_t2 %>% drop_na(y, dem, lag1, lag2, lag3, lag4, lag5, lag6, lag7, lag8)
data_m4 <- pdata.frame(data_m4, index = c("country_name", "year"))

maxlag <- 49

model_1_gmm <- pgmm(
  y ~ dem + lag(y, 1) | lag(y, 2:maxlag) + lag(dem, 1:maxlag),
  data = data_m1,
  effect = "twoways",
  model = "twosteps",
  transformation = "d"
)

model_2_gmm <- pgmm(
  y ~ dem + lag(y, 1) + lag(y, 2) | lag(y, 2:maxlag) + lag(dem, 1:maxlag),
  data = data_m2,
  effect = "twoways",
  model = "twosteps",
  transformation = "d"
)

model_3_gmm <- pgmm(
  y ~ dem + lag(y, 1) + lag(y, 2) + lag(y, 3) + lag(y, 4) | lag(y, 2:maxlag) + lag(dem, 1:maxlag),
  data = data_m3,
  effect = "twoways",
  model = "twosteps",
  transformation = "d"
)

model_4_gmm <- pgmm(
  y ~ dem + lag(y, 1) + lag(y, 2) + lag(y, 3) + lag(y, 4) +
    lag(y, 5) + lag(y, 6) + lag(y, 7) + lag(y, 8) |
    lag(y, 2:maxlag) + lag(dem, 1:maxlag),
  data = data_m4,
  effect = "twoways",
  model = "twosteps",
  transformation = "d"
)

compute_dynamic_effect <- function(dem_coef, lag_coefs, n_periods) {
  effects <- numeric(n_periods)
  effects[1] <- dem_coef
  k <- length(lag_coefs)
  if (n_periods > 1) {
    for (i in 2:n_periods) {
      eff <- dem_coef
      for (j in 1:min(i - 1, k)) {
        eff <- eff + effects[i - j] * lag_coefs[j]
      }
      effects[i] <- eff
    }
  }
  return(effects[n_periods])
}

coef_1 <- coef(model_1_gmm)
dem_coef_1 <- coef_1["dem"]
lag1_1 <- coef_1["lag(y, 1)"]
lre1 <- dem_coef_1 / (1 - lag1_1)
pers1 <- lag1_1
eff_25_1 <- compute_dynamic_effect(dem_coef_1, c(lag1_1), 25)

coef_2 <- coef(model_2_gmm)
dem_coef_2 <- coef_2["dem"]
lag1_2 <- coef_2["lag(y, 1)"]
lag2_2 <- coef_2["lag(y, 2)"]
lre2 <- dem_coef_2 / (1 - (lag1_2 + lag2_2))
pers2 <- lag1_2 + lag2_2
eff_25_2 <- compute_dynamic_effect(dem_coef_2, c(lag1_2, lag2_2), 25)

coef_3 <- coef(model_3_gmm)
dem_coef_3 <- coef_3["dem"]
lag1_3 <- coef_3["lag(y, 1)"]
lag2_3 <- coef_3["lag(y, 2)"]
lag3_3 <- coef_3["lag(y, 3)"]
lag4_3 <- coef_3["lag(y, 4)"]
lre3 <- dem_coef_3 / (1 - (lag1_3 + lag2_3 + lag3_3 + lag4_3))
pers3 <- lag1_3 + lag2_3 + lag3_3 + lag4_3
eff_25_3 <- compute_dynamic_effect(dem_coef_3, c(lag1_3, lag2_3, lag3_3, lag4_3), 25)

coef_4 <- coef(model_4_gmm)
dem_coef_4 <- coef_4["dem"]
lag1_4 <- coef_4["lag(y, 1)"]
lag2_4 <- coef_4["lag(y, 2)"]
lag3_4 <- coef_4["lag(y, 3)"]
lag4_4 <- coef_4["lag(y, 4)"]
lag5_4 <- coef_4["lag(y, 5)"]
lag6_4 <- coef_4["lag(y, 6)"]
lag7_4 <- coef_4["lag(y, 7)"]
lag8_4 <- coef_4["lag(y, 8)"]
lre4 <- dem_coef_4 / (1 - (lag1_4 + lag2_4 + lag3_4 + lag4_4 + lag5_4 + lag6_4 + lag7_4 + lag8_4))
pers4 <- lag1_4 + lag2_4 + lag3_4 + lag4_4 + lag5_4 + lag6_4 + lag7_4 + lag8_4
eff_25_4 <- compute_dynamic_effect(dem_coef_4, c(lag1_4, lag2_4, lag3_4, lag4_4, lag5_4, lag6_4, lag7_4, lag8_4), 25)

lre <- round(c(lre1, lre2, lre3, lre4), 3)
pers <- round(c(pers1, pers2, pers3, pers4), 3)
eff_25 <- round(c(eff_25_1, eff_25_2, eff_25_3, eff_25_4), 3)

se1 <- sqrt(diag(vcov(model_1_gmm)))
se2 <- sqrt(diag(vcov(model_2_gmm)))
se3 <- sqrt(diag(vcov(model_3_gmm)))
se4 <- sqrt(diag(vcov(model_4_gmm)))

override.coef.1 <- c(
  coef_1["dem"],
  coef_1["lag(y, 1)"],
  rep(NA, 7)
)
override.se.1 <- c(
  se1["dem"],
  se1["lag(y, 1)"],
  rep(NA, 7)
)
override.coef.2 <- c(
  coef_2["dem"],
  coef_2["lag(y, 1)"],
  coef_2["lag(y, 2)"],
  rep(NA, 6)
)
override.se.2 <- c(
  se2["dem"],
  se2["lag(y, 1)"],
  se2["lag(y, 2)"],
  rep(NA, 6)
)
override.coef.3 <- c(
  coef_3["dem"],
  coef_3["lag(y, 1)"],
  coef_3["lag(y, 2)"],
  coef_3["lag(y, 3)"],
  coef_3["lag(y, 4)"],
  rep(NA, 4)
)
override.se.3 <- c(
  se3["dem"],
  se3["lag(y, 1)"],
  se3["lag(y, 2)"],
  se3["lag(y, 3)"],
  se3["lag(y, 4)"],
  rep(NA, 4)
)
override.coef.4 <- c(
  coef_4["dem"],
  coef_4["lag(y, 1)"],
  coef_4["lag(y, 2)"],
  coef_4["lag(y, 3)"],
  coef_4["lag(y, 4)"],
  coef_4["lag(y, 5)"],
  coef_4["lag(y, 6)"],
  coef_4["lag(y, 7)"],
  coef_4["lag(y, 8)"]
)
override.se.4 <- c(
  se4["dem"],
  se4["lag(y, 1)"],
  se4["lag(y, 2)"],
  se4["lag(y, 3)"],
  se4["lag(y, 4)"],
  se4["lag(y, 5)"],
  se4["lag(y, 6)"],
  se4["lag(y, 7)"],
  se4["lag(y, 8)"]
)

models <- list(model_1_gmm, model_2_gmm, model_3_gmm, model_4_gmm)

texreg(
  models,
  override.coef = list(override.coef.1, override.coef.2, override.coef.3, override.coef.4),
  override.se = list(override.se.1, override.se.2, override.se.3, override.se.4),
  custom.model.names = c("(1)", "(2)", "(3)", "(4)"),
  custom.coef.names = c(
    "Democracy", "Lag 1", "Lag 2", "Lag 3", "Lag 4",
    "Lag 5", "Lag 6", "Lag 7", "Lag 8"
  ),
  custom.gof.rows = list(
    "Persistence" = pers,
    "Long run effect" = lre,
    "Effect after 25 years" = eff_25
  ),
  file = "output/table_2_GMM.tex",
  caption = "Effect of Democracy on (Log) GDP per Capita: Arellanoâ€“Bond GMM Estimation"
)
```

\input{output/table_2_GMM.tex}





